# 4주 차

유형: 📒 수업
주제: 데이터 활용 및 그래프 출력
키워드: 빅데이터, 실습, 응용, 이론, 통계

# 통계 분석

---

요즘 4차산업이나 SNS으로 인하여 사람들이 수 많은 데이터를 만들거나 가공하여 새로운 데이터를 만들게 된다.

데이터에서도 어떠한 수치가 있을텐데, 그러한 수치를 통계를 만들고나서 그러한 내용들을 바탕으로 분석한 내용을 언급하면 된다.

그러한 데이터들을 잘 가공하면 좋은 의미의 데이터(정보)을 얻음으로써 개발뿐만 아니라 비즈니스 부분에서도 도움이 될 것이다.

예를 들자면, 

요즘 **핫하고 있는 저출산, 사망자 수에 대한 내용**을 알아볼 수 있겠다.  **왜 우리가 저출산 내용이 언급이 되어 있는지** 확인해보자.

## 데이터 수집 및 조사

### 데이터 제공하고 있는 기관을 찾아가보자

---

이러한 데이터들은 우리가 손쉽게 구할 수 있는 것은 아니다. 이러한 인구 관련된 데이터를 가지고 있는 기관에게 찾으면 되겠다.

 

기관은 정부쪽에서 가지고 있다. 왜냐하면 우리가 태어날때부터 출생 신고를 해야하기 때문에 출산 건수를 확인 해볼 수 있고, 출산 신고를 통해서 우리는 현재 나이를 찾을 수 있다. 

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled.png)

정부에서도 관리하는 부서가 다양하다. 데이터 관련된 부분은 통계청에 확인해보면 될 것이다.

### 데이터를 찾아가보기

---

우리는 통계청을 통해서 데이터를 가져오면 될 것이다. 데이터 관련된 내용들은 “[KOSIS 국가통계포털](https://kosis.kr/index/index.do)”에서 확인해보면 되겠다.

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%201.png)

우리가 원하는 내용을 검색해보자 작성자 기준으로는 출생이라고 찾아보자

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%202.png)

검색된 내용을 기반으로 통계를 확인해보고 싶은 내용을 찾아서 해봐도 되겠지만 우리는 “[시군구 / 인구동태건수 및 동태율(출생, 사망, 혼인, 이혼)](https://kosis.kr/statHtml/statHtml.do?orgId=101&tblId=DT_1B8000I&vw_cd=MT_ZTITLE&list_id=A2_6&seqNo=&lang_mode=ko&language=kor&obj_var_id=&itm_id=&conn_path=MT_ZTITLE)”을 들어가서 확인해보자.

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%203.png)

이처럼 데이터가 나올 것이다. 

전국 내용 뿐만 아니라, 시군구에 대한 출생, 사망, 이혼, 이혼 등등 내용이 있다.

우리는 전국 데이터를 조회 해보고, 2021년 뿐만 아니라 2021년도 이전의 년도인 2000년도부터 데이터를 추출해보자

추출하는 방법은 짐작 가겠지만, 오른쪽 초록색 버튼인 조회설정 버튼을 눌러서 데이터 범위를 바꿔주면 된다.

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%204.png)

여기에서 우리가 항목을 바꿔서 사용할 수 있는데, 우리는 출생, 사망만 확인할 것이기에 출생건수, 사망건수를 제외한 나머지 항목을 체크해제한다.

아래처럼 하면 되겠다.

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%205.png)

다음으로 우리는 “행정구역별”에 들어가서 시군구 내용을 체크 풀려고 한다.

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%206.png)

시군구 내용이 있는데, 우리는 전국 항목 체크만하고, 나머지는 체크를 해제하면 된다.

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%207.png)

이처럼 작업해보자.

이제 마지막으로 년도 범위를 지정해야한다. “시점” 항목에 들어가서 년도 범위를 지정하자.

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%208.png)

위에서 말한 것처럼 우리는 2000년도부터 2021년까지 해볼려고 한다. 그러면 외쪽 항목에서 2000으로 바꾸면 된다.

 

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%209.png)

이처럼 항목을 바꿔서 처리 해본다.

데이터 범위를 지정했으면 상단에 조회 버튼을 눌러서 내용을 확인해보자.

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%2010.png)

위의 이미지처럼 데이터가 나올 것이다. 

그렇게 나왔으면 우리가 데이터를 찾고 싶은 항목이 구해지는 것이다.

그 데이터를 우리가 다운로드를 받아보자.

조회설정 버튼 바로 왼쪽에 다운로드 버튼이 있는데, 그것을 눌러서 파일로 다운로드 받아보자

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%2011.png)

파일형태를 csv로 바꾼 후에 하단에 다운로드 받아서 진행하면 된다.

### 데이터있는 것과 없는 것들

---

이처럼 어떤 업체나, 정부 부서를 이용해서 데이터를 가져올 수 있다. 그렇지만, 가끔 우리가 원하던 내용이 시중에 있을 수 있지만, 없는 경우도 있다. ~~데이터가 없으면 우리는 데이터를 수집을 해서 모을 수 밖에 없다.~~ 

## 데이터 분석

---

이제 우리는 방금 다운로드 받았던 내용을 기반으로 데이터를 처리를 해보자

우리가 데이터 분석하기 위해서는 어떠한 주제를 할 것인지를 확인해보자. 뭐 우리가 가지고 있는 데이터가 년도별 출생, 사망 데이터이니, 그 것과 관련이 있는 내용으로 분석해보면 되겠다.

우리는 그래프를 그려서 시각화하는 예제를 다뤄보자

우리가 사용해야하는 것들은 기본적으로 Python의 Pandas, Numpy, Matplotlib으로 사용하면 되겠다.

### 각 라이브러리를 어떻게 사용할 건가?

---

전에서 언급했었던 내용이 있긴 했었다.

- Pandas는 데이터를 불러오고, 처리하는데 쉬운 라이브러리
- Numpy는 파이썬 리스트를 좀 더 많은 기능이 있다.
- Matplotlib은 그래프를 쉽게 출력할 수 있다.

이 라이브러리를 데이터를 어떤식으로 할 것인지 생각해보자

우리는 어떠한 파일들 안에 있는 데이터를 불러오는 작업이 필요하다. 이것은 우리가 Pandas로 데이터를 쉽게 불러 올 것이다.

그 다음 우리가 데이터를 그래프를 출력 할 수 있게 데이터 형태를 바꿔서 처리를 해야한다. (Pandas는 데이터를 가공하는데 도움이 되지만, Matplotlib은 파이썬 List 자료형이나, Numpy의 array로 사용해야한다.)

그러한 데이터를 이용해서 그래프를 출력하면 된다.

## 이제 실습 해보자.

---

우리가 작업하는 경로와 똑같은 파일 경로에 데이터를 넣는다 예를 들면 이처럼 하면 된다.

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%2012.png)

### 데이터를 불러오자.

---

우리는 Pandas로 데이터를 불러와야한다. 우리는 결국 csv 파일을 불러와야하는 상황이기 때문에 Pandas 공식 docs에 csv를 불러올 수 있는 함수를 찾아보면 된다.

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%2013.png)

여기에서 간단하게 언급을 해보고자 한다.

pandas.read_csv()를 이용하여 파일을 불러올 수 있고,

인자에 파일 이름이나, 경로를 입력해서 경로에 해당하는 파일을 csv 형태로 불러와주는 형태이다.

결국 우리가 파일을 불러올러면

```python
import pandas as pd

df = pd.read_csv('시군구_인구동태건수_및_동태율_출생_사망_혼인_이혼__20221228170359.csv')
```

- 각자 파일 명이 다르기에 위와 같은 코드를 따라 치면 안된다.

이처럼 불러오면 되고, 읽은 파일 내용을 “df” 변수에 저장이 된다는 의미의 코드이다. 추가로 인자에 encoding 개념이 들어가있는데, 들어가진 이유가 기본적으로 utf-8 인코딩으로 불러오면 불러오지 않은 에러가 발생이 된다.

```markdown
---------------------------------------------------------------------------
UnicodeDecodeError                        Traceback (most recent call last)

UnicodeDecodeError: 'utf-8' codec can't decode byte 0xc7 in position 1: invalid continuation byte
```

해결 하는 방안은 한글을 읽을 수 있는 encoding을 설정하면 된다. 한글은 “cp949”로 인식할 수 있기에 encoding=’cp949’를 추가로 입력하면 된다.

```python
df = pd.read_csv('시군구_인구동태건수_및_동태율_출생_사망_혼인_이혼__20221228170359.csv',encoding='cp949')
```

그러면 정상적으로 실행이 될 것이다.

이제 코드를 실행하고, df를 출력해보자

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%2014.png)

이처럼 데이터가 굉장히 많이 출력이 된다.

### 데이터 전처리

---

이제 우리가 출생이랑, 사망건을 쪼개는 작업이 필요하다.

그렇게 할러면 columns를 행정 구역으로 바꿔서 처리하면 굉장히 편하게 작업할 수 있다.(왜 그렇게 해야하는지는 추후에 알 것이다.)

이러한 처리는 행렬처리를 하면 된다.

이것 또한 Pandas에서 제공하고 있다.

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%2015.png)

위에 문서에서 행렬 변환해주는 기능이 있다고 친절하게(?) 나와있음을 확인해볼 수 있다.

암튼 행렬변환이 된다고 하니 사용하는 방법을 예시로 보자

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%2016.png)

보니깐 df.T로 행렬 변환이 되는 것을 할 수 있고, 옆에 주석으로 보다시피 df.transpose()로도 똑같은 결과를 얻을 수 있다고 적혀져 있다.

이제 우리는 무엇을 할 것인지 짐작하겠지만,

```python
df = df.transpose()
```

을 입력하고 df를 출력해보면 된다.

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%2017.png)

이러한 형태로 출력이 된다.

지금 문제가 있는 것이 보인다.

- 열의 이름이 0,1로 되어 있다.
- 첫번째 행이 열의 이름으로 넣어야 한다.

라는 것이다. 결국 우리가 처리 해야하는 것은

- 첫번째 행을 추출해서 열의 이름으로 등록
- 첫번째 행을 삭제

처리가 필요하다.

### 행 추출

---

그럼 첫번째로 첫번째 행을 추출 해보자

첫번째 행을 가져 오는 방법은 iloc를 사용해보면 좋을 것 이다.

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%2018.png)

iloc는 행을 추출하는 것으로 보면 된다. iloc는 일반적인 List 형태로 되어 있어서 list 문법으로 행을 추출할 수 있다.

```python
df.iloc[0]
```

위의 코드처럼 쓰면 1번째 행(쉽게 말해 1번째 줄에 있는 데이터)이 추출이 된다.  데이터를 추출하는 코드는 아래처럼 쓰면 된다.

```python
df.iloc[0].to_numpy()
```

위 코드를 실행하면 1번째 줄에 있는 데이터가 출력이 된다.

```python
array(['행정구역별', '전국'], dtype=object)
```

이제 이 데이터를 이용하여 열의 이름을 바꿔보자

### 열 이름 변경

---

일반적으로 

열 이름을 바꾸는 방법은 다양하지만, df.columns 요소 변수를 변경하면 된다.

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%2019.png)

(~~이것이 불친절한 pandas API docs~~)

df.columns 값을 바꾸면 그 바뀐 값으로 열 이름이 변경이 된다. 

아래처럼 작성하면 처음에 우리가 구했던 1번째 행의 데이터를 열 이름으로 변경할 수 있다.

```python
df.columns = df.iloc[0].to_numpy()
```

이런식으로 코드를 치고 출력 해보자

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%2020.png)

이 처럼 결과가 나올 것인데, 이제 첫번째 행을 지우는 코드를 쓰면 되겠다.

### 행 삭제하기

---

여기에서 첫번째 행이 행정구역별로 되어 있는데, 그 구역 기준으로 행을 삭제 하면 된다.

삭제하는 것은 df.drop()으로 쓰인다.

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%2021.png)

어떤 라벨을 지울것인지(index) 내용을 작성해줘야 한다. 첫번째 행이 ‘행정구역별’ label 이기에 아래처럼 코드 작성하면 첫 번째 행이 지워진다.

```python
df = df.drop('행정구역별')
```

이런식으로 코드 실행하면 ,위에서 언급했던 문제점들이 해결이 되는 것을 볼 수 있다.

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%2022.png)

### 추출하기

---

이제 우리가 해야하는 것은 행정구역별이 출생건수, 사망건수를 따로 추출하면 되겠다.

그러면 ‘행정구역별’ 요소에서 ‘출생건수 (명)’인 것과 ‘사망건수 (명)’ 인 데이터 기준으로 데이터를 나누면 된다.

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%2023.png)

boolean indexing 이용해서 특정 조건에 대한 값을 추출 할 수 있다.

```python
df[df['행정구역별'] == '출생건수 (명)']
```

이 코드는 ‘행정구역별’ 내용에서 출생건수 (명) 인 요소만 띄우라는 말이다.

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%2024.png)

```python
df[df['행정구역별'] == '사망건수 (명)']
```

‘행정구역별’ 내용에서 사망건수 (명) 인 요소만 띄우라는 말이다.

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%2025.png)

년도별 출생건수랑, 사망건수가 나누어진 것을 볼 수 있다. 이제 Matplotlib에서 쓸 수 있는 자료형으로 변환해보자.

이제 우리가 필요한건 ‘전국’ 몇명인지 숫자만 필요하고, 그것을 numpy 배열로 만들 필요가 있다.

쉽게 말해 이제 해야하는 것은 다음과 같다.

- ‘전국’ 요소만 띄우기
- numpy 배열로 변환하기

### ‘전국’ 요소만 띄우기

---

이제 전국 요소는 위에서 배운 내용으로 활용하면 된다.

전국만 뽑아내는 방법은 다음과 같다.

위에서 봤던 boolean indexing 을 활용한다면 전국 요소만 띄어진다.

```python
출생수 = df[df['행정구역별'] == '출생건수 (명)'] # 행정구역별 요소에서 출생건수 (명)안 데이터 추출
출생수 = 출생수[['전국']].to_numpy(dtype='int') # numpy 배열로 변환하고, 정수형 데이터로 변환해주는 작업
```

```python
사망수 = df[df['행정구역별'] == '사망건수 (명)'] # 행정구역별 요소에서 사망건수 (명)안 데이터 추출
사망수 = 사망수[['전국']].to_numpy(dtype='int') # numpy 배열로 변환하고, 정수형 데이터로 변환해주는 작업
```

출생수, 사망수를 출력하면 다음처럼 나올것이다.

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%2026.png)

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%2027.png)

이제 우리는 그래프를 출력할 데이터가 준비가 되었다. 이제 우리는 그래프를 출력할 수 있는 상태로 만들어보자

### 그래프 출력

---

1주차때 그래프 출력해주는 Matplotlib를 사용해보고자 한다.

우리는 Matplotlib를 사용하는데 먼저 불러와야한다.

```python
import matplotlib.pyplot as plt
```

처럼 사용한다.

이제 그래프를 우리가 꺾은선 그래프로 출력해보자

꺾은선 그래프는 plt.plot() 형태로 쓰면 알아서 꺾은선 그래프로 출력될 것이다. (최적 환경에 맞춰서 그래프 출력)

그래프 출력하는 방법은 plt.plot(x값,y값, …(기타 등등)) 처럼 사용된다. (공식 문서를 확인해서 사용방법 확인해도 좋다.)

1주 차에서 배운 내용을 활용해서 출력해보자

plt.plot()으로 그래프 출력해보자.

```python
plt.plot(list(range(2000,2022)),사망수,label='death') # 사망수 데이터로 꺾은선 그래프 출력  
plt.plot(list(range(2000,2022)),출생수,label='birth') # 출생수 데이터로 꺾은선 그래프 출력

plt.legend() # 범례 출력
plt.show() # 그래프 출력
```

출력은 다음처러 될 것이다.

![Untitled](4%E1%84%8C%E1%85%AE%20%E1%84%8E%E1%85%A1%201899d04e029249559e7ab070b98bbe07/Untitled%2028.png)

## 통계 분석

---

이제 데이터 분석했으면, 분석한 결과를 토대로 앞으로 진행이 될 것인지 등등 분석하면 된다.

일단 확실한 내용(펙트)은

대략적으로 보면 2019년 이후로 자연감소가 진행되고 있다는 것을 확인 해볼 수 있다.

이런식으로 내용 본다면 다양한 분석이 나온다.

- 저출산이 엄청나게 심각하다.
- 의료 발전이 높아진 상태임에도 불구하고, 사망자수가 점차 늘어나는 것은 큰 문제임을 확인
- 인구수가 앞으로 점자 줄어들 예정이다.
- 출생자가 점차 줄어들기 때문에 지방에 있는 학교 폐교가 될 경우가 많아질 것이다.
- 노인 고령화가 더욱 심화될 것이다.
- 2050년 이후론 생산할 인구가 없어 대한민국 발전에 더디게 될 것이다.

이러한 등등 분석해볼 수 있다고 볼 수 있다.